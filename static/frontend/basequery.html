<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>南投環保局空氣品質淨化區資訊網</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

</head>
<style>
  .table tbody tr {
    height: 60px;  /* 固定行高 */
    vertical-align: middle;
    text-align: center;
  }
</style>

<body class="category-page">

  <header id="header" class="header d-flex align-items-center position-relative">
    <div class="container position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.webp" alt=""> -->
        <h1 class="sitename"><img src="assets/img/logo.png" alt="Blog Hero Image"></h1>
      </a>
      <nav id="navmenu" class="navmenu">
        <ul id="nav-dynamic"></ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>


    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1 class="heading-title">基地查詢</h1>
              <p class="mb-0">淨化區建置進度、活動紀錄與環境改善亮點，透過影像與文字分享南投縣推動永續的努力。透過照片、影音與文字故事，呈現綠化成果、社區參與及政策推動的點滴。.</p>
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="index.html">首頁</a></li>
            <li class="current">基地介紹</li>
          </ol>
        </div>
      </nav>
    </div><!-- End Page Title -->
     
    <div class="container mt-4">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="form-floating">
            <select class="form-select" id="air-year" aria-label="年度篩選">
              <option selected>不分年度</option>
              <option value="1">2025</option>
              <option value="2">2024</option>
              <option value="3">2023</option>
            </select>
            <label for="floatingSelect">年度篩選</label>
          </div>
        </div>
        <div class="col-12 col-md-4 mb-3">
          <div class="form-floating">
            <select class="form-select" id="air-type" aria-label="類別篩選">
              <option selected>不分類別</option>
              <option value="1">空氣品質淨化</option>
              <option value="2">綠美化</option>
              <option value="3">空氣綠牆</option>
            </select>
            <label for="floatingSelect">類別篩選</label>
          </div>
        </div>
        <div class="col-12 col-md-4 mb-3">
          <div class="form-floating">
            <select class="form-select" id="air-zone" aria-label="行政區">
              <option selected>不分行政區</option>
              <option value="1">南投市</option>
              <option value="2">埔里鎮</option>
              <option value="3">草屯鎮</option>
              <option value="4">竹山鎮</option>
              <option value="5">集集鎮</option>
              <option value="6">名間鄉</option>
              <option value="7">中寮鄉</option>
              <option value="8">鹿谷鄉</option>
              <option value="9">水里鄉</option>
              <option value="10">魚池鄉</option>
              <option value="11">國姓鄉</option>
              <option value="12">信義鄉</option>
              <option value="13">仁愛鄉</option>
            </select>
            <label for="floatingSelect">行政區篩選</label>
          </div>
        </div>
        <div class="col-12 col-md-1 mb-3 d-flex justify-content-end">
          <button class="btn btn-dark btn-lg" type="submit">查詢</button>
        </div>

      </div>
    </div>

    <div class="container my-4">
      <div class="card shadow-sm rounded-3">
        <!-- 手機可水平 + 垂直捲動 -->
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
          <table class="table zebra table-hover align-middle mb-0 w-100 w-sm-100" style="min-width: 700px;">
            <tbody id="bases-tbody">
              <!-- rows will be injected here -->
            </tbody>
            <thead class="table-primary sticky-top text-center" style="height: 60px; vertical-align:middle;">
              <tr>
                <th scope="col">年度</th>
                <th scope="col">行政區</th>
                <th scope="col">類別</th>
                <th scope="col">基地/計劃名稱	</th>
                <th scope="col">維護單位</th>
                <th scope="col">點選更多</th>
              </tr>
            </thead>
            <tbody>
              <!-- <tr class="clickable-row" data-href="base-details.html">
                <td>114</td>
                <td>信義鄉</td>
                <td>空氣品質淨化</td>
                <td>嘉興國小空品淨化區設置計畫</td>
                <td>嘉興國民小學</td>
                <td>詳細資料➜</td>
              </tr>
              <tr class="clickable-row" data-href="base-details.html">
                <td>115</td>
                <td>信義鄉</td>
                <td>空氣品質淨化</td>
                <td>嘉興國小空品淨化區設置計畫</td>
                <td>嘉興國民小學</td>
                <td>詳細資料➜</td>
              </tr>
              <tr class="clickable-row" data-href="base-details.html">
                <td>115</td>
                <td>信義鄉</td>
                <td>空氣品質淨化</td>
                <td>嘉興國小空品淨化區設置計畫</td>
                <td>嘉興國民小學</td>
                <td>詳細資料➜</td>
              </tr>
              <tr class="clickable-row" data-href="base-details.html">
                <td>115</td>
                <td>信義鄉</td>
                <td>空氣品質淨化</td>
                <td>嘉興國小空品淨化區設置計畫</td>
                <td>嘉興國民小學</td>
                <td>詳細資料➜</td>
              </tr>
               -->

            </tbody>

          </table>
        </div>
      </div>
    </div>

    <section id="pagination-2" class="pagination-2 section">

      <div class="container">
        <div class="d-flex justify-content-center">
          <ul>
            <li><a href="#"><i class="bi bi-chevron-left"></i></a></li>
            <li><a href="#">1</a></li>
            <li><a href="#" class="active">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li>...</li>
            <li><a href="#">10</a></li>
            <li><a href="#"><i class="bi bi-chevron-right"></i></a></li>
          </ul>
        </div>
      </div>

    </section><!-- /Pagination 2 Section -->
    
    

  </main>

  <footer id="footer" class="footer position-relative light-background">

    <div class="container">
      <div class="row gy-5">

        <div class="col-lg-4">
          <div class="footer-brand">
            <a href="index.html" class="logo d-flex align-items-center mb-3">
              <h4>南投縣政府環境保護局</h4>
            </a>
            <p class="tagline">上班(服務)時間：<br>上午 08:00-12:00；下午 13:30-17:30 <br>(週六、日及例假日休息)</p>

            <div class="social-links mt-4">
              <a href="#" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
              <a href="#" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="footer-links-grid">
            <div class="row">
              <div class="col-6 col-md-4">
                <h5>首頁區塊</h5>
                <ul class="list-unstyled">
                  <li><a href="index.html#latest-posts">最新花絮</a></li>
                  <li><a href="index.html#greensituation">綠地現況</a></li>
                  <li><a href="index.html#numberbases">基地數量</a></li>
                </ul>
              </div>
              <div class="col-6 col-md-4">
                <h5>基地介紹</h5>
                <ul class="list-unstyled">
                  <li><a href="basequery.html?type=air">空氣品質淨化區</a></li>
                  <li><a href="basequery.html?type=wall">清淨綠牆</a></li>
                  <li><a href="basequery.html?type=green">綠美化</a></li>
                </ul>
              </div>
              <div class="col-6 col-md-4">
                <h5>其他頁面</h5>
                <ul class="list-unstyled">
                  <li><a href="species.html">樹種介紹</a></li>
                  <li><a href="download.html">文件下載</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-2">
          <div class="footer-cta">
            <h5>聯絡我們</h5>
            <p>TEL：(049)223-7530</p>
          </div>
        </div>

      </div>
    </div>

    <div class="footer-bottom">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="footer-bottom-content">
              <p class="mb-0">© <strong>南投縣政府環境保護局版權所有</strong>. All rights reserved.</p>
              <div class="credits">
                Designed by 艾可森數位學習有限公司</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <script>
    (async () => {
const API_BASE = ""; // same origin (if Flask runs at same port)
const ul = document.getElementById("nav-dynamic");
if (!ul) return;

// 1️⃣ Fetch visible sections
let sections = [];
try {
  const res = await fetch(`${API_BASE}/api/site/sections`, { credentials: "same-origin" });
  if (res.ok) sections = await res.json();
} catch (err) {
  console.error("Failed to load site sections:", err);
}

// 2️⃣ Build dropdown only for visible ones
const visible = sections.filter(s => s.is_visible);
if (visible.length > 0) {
  const li = document.createElement("li");
  li.className = "dropdown";

  const dropdownToggle = `
    <a href="#"><span>基地介紹</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
  `;
  const subUl = document.createElement("ul");

  visible.forEach(sec => {
    const label = sec.label;
    const a = document.createElement("a");
    a.href = `basequery.html?type=${encodeURIComponent(label)}`;
    a.textContent = label;
    const liSub = document.createElement("li");
    liSub.appendChild(a);
    subUl.appendChild(liSub);
  });

  li.innerHTML = dropdownToggle;
  li.appendChild(subUl);
  ul.appendChild(li);
}

// 3️⃣ Append the static parts (always present)
const staticLinks = [
  { label: "最新成果", href: "articles.html" },
  { label: "樹種介紹", href: "species.html" },
  { label: "文件下載", href: "download.html" },
];

staticLinks.forEach(item => {
  const li = document.createElement("li");
  li.innerHTML = `<a href="${item.href}">${item.label}</a>`;
  ul.appendChild(li);
});
})();
  </script>

</body>

</html>

<script>

document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(location.search);
  const type = params.get("type"); // ex: air | wall | green
  const select = document.getElementById("air-type");

  // Simple mapping
  const map = {
    air: "空氣品質淨化",
    wall: "清淨綠牆",
    green: "綠美化"
  };

  if (type && select && map[type]) {
    // find the matching <option> by text
    [...select.options].forEach(opt => {
      if (opt.textContent.includes(map[type])) {
        select.value = opt.value;
      }
    });

    // trigger change event so your existing script runs
    select.dispatchEvent(new Event("change"));
  }
});
  document.querySelectorAll(".clickable-row").forEach(row => {
    row.addEventListener("click", () => {
      window.location.href = row.dataset.href;
    });
  });
  (() => {
  // -----------------------------
  // Helpers
  // -----------------------------
  const $ = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

  // Try to get a specific tbody if you add id="results-body", else fallback to first table
  const resultsBody = document.getElementById('results-body') || $('.table tbody');

  // Read the SELECT's display text (your <option> values are 1/2/3 etc., so use text)
  function getSelectedText(selectId) {
    const el = document.getElementById(selectId);
    if (!el) return '';
    const opt = el.options[el.selectedIndex];
    return (opt && opt.textContent.trim()) || '';
  }

  // Map dropdown text → API base
  function getApiBaseByType(typeText) {
    if (typeText.includes('清淨綠牆') || typeText.includes('空氣綠牆')) return '/api/green_walls';
    if (typeText.includes('綠美化')) return '/api/greenifications';
    // default to 空氣品質淨化區
    return '/api/purification_zones';
  }

  // Normalise "年度" text into a year or empty
  function parseYear(text) {
    // Accept "2025", "2024", "不分年度"
    const y = text.replace(/[^\d]/g, '');
    return /^\d{4}$/.test(y) ? y : '';
  }

  // Build query string with only provided params
  function buildQuery(params) {
    const usp = new URLSearchParams();
    Object.entries(params).forEach(([k, v]) => {
      if (v !== undefined && v !== null && String(v).trim() !== '') usp.set(k, v);
    });
    const s = usp.toString();
    return s ? `?${s}` : '';
  }

  // Safely pick first existing property from a list of candidates
  function pick(obj, ...keys) {
    for (const k of keys) {
      if (obj && obj[k] !== undefined && obj[k] !== null && obj[k] !== '') return obj[k];
    }
    return '';
  }

  // Render one row
  function renderRow(rec, categoryLabel, detailsHrefBase='base-details.html') {
    const id         = pick(rec, 'id');
    const year       = pick(rec, 'year', 'budget_year', 'project_year') || '—';
    const district   = pick(rec, 'district', 'township', 'area') || '—';
    const name       = pick(rec, 'name', 'project_name', 'site_name', 'title') || '—';
    const maintainer = pick(rec, 'maintainer', 'maintenance_unit', 'owner_unit') || '—';

    // Include type in details URL so the next page can hit the right API
    const typeParam = encodeURIComponent(categoryLabel);
    const href = `${detailsHrefBase}?type=${typeParam}&id=${encodeURIComponent(id)}`;

    const tr = document.createElement('tr');
    tr.className = 'clickable-row';
    tr.dataset.href = href;
    tr.innerHTML = `
      <td>${year}</td>
      <td>${district}</td>
      <td>${categoryLabel}</td>
      <td>${escapeHtml(name)}</td>
      <td>${escapeHtml(maintainer)}</td>
      <td>詳細資料➜</td>
    `;
    // click-to-navigate
    tr.addEventListener('click', () => { window.location.href = href; });
    return tr;
  }

  function escapeHtml(s) {
    return String(s).replace(/[&<>"']/g, m => (
      { '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;' }[m]
    ));
  }

  // Row states
  function showLoading() {
    if (!resultsBody) return;
    resultsBody.innerHTML = `
      <tr><td colspan="6" style="text-align:center; padding:24px;">載入中⋯⋯</td></tr>
    `;
  }
  function showEmpty() {
    if (!resultsBody) return;
    resultsBody.innerHTML = `
      <tr><td colspan="6" style="text-align:center; padding:24px;">沒有符合條件的資料</td></tr>
    `;
  }
  function showError(msg) {
    if (!resultsBody) return;
    resultsBody.innerHTML = `
      <tr><td colspan="6" style="text-align:center; padding:24px; color:#b00020;">載入失敗：${escapeHtml(msg || 'Unknown error')}</td></tr>
    `;
  }

  // Avoid race conditions when users click quickly
  let currentAbort = null;

  async function loadAndRender() {
    const typeText     = getSelectedText('air-type') || '空氣品質淨化';
    const yearText     = getSelectedText('air-year') || '';
    const districtText = getSelectedText('air-zone') || '';

    const apiBase = getApiBaseByType(typeText);
    const year = parseYear(yearText);
    const district = districtText.includes('不分') ? '' : districtText;

    const qs = buildQuery({ year, district });
    const url = `${apiBase}${qs}`;

    // cancel previous
    if (currentAbort) currentAbort.abort();
    currentAbort = new AbortController();
    const { signal } = currentAbort;

    try {
      showLoading();
      const res = await fetch(url, { signal });
      if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
      const data = await res.json();

      const arr = Array.isArray(data) ? data : [];
      if (!arr.length) { showEmpty(); return; }

      // Fill table
      resultsBody.innerHTML = '';
      for (const rec of arr) {
        resultsBody.appendChild(renderRow(rec, typeText));
      }
    } catch (err) {
      if (err.name === 'AbortError') return; // silently ignore aborted request
      showError(err.message);
      console.error('Fetch failed:', err);
    }
  }

  // -----------------------------
  // Wire up UI
  // -----------------------------
  const btn = document.querySelector('button.btn.btn-dark.btn-lg[type="submit"]');
  if (btn) btn.addEventListener('click', (e) => {
    e.preventDefault();
    loadAndRender();
  });

  // Also react to dropdown changes for instant feedback
  ['air-year','air-type','air-zone'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('change', loadAndRender);
  });

  // Initial load
  document.addEventListener('DOMContentLoaded', loadAndRender);
})();
</script>