<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>南投環保局空氣品質淨化區資訊網</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

</head>

<body class="search-results-page">

  <header id="header" class="header d-flex align-items-center position-relative">
    <div class="container position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.webp" alt=""> -->
        <h1 class="sitename"><img src="assets/img/logo.png" alt="Blog Hero Image"></h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li class="dropdown"><a href="#"><span>基地介紹</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="basequery.html">空氣品質淨化區</a></li>
              <li><a href="basequery.html">清淨綠牆</a></li>
              <li><a href="basequery.html">綠美化</a></li>


              <!-- <li class="dropdown"><a href="#"><span>基地介紹</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                  <li><a href="#">空品淨化區</a></li>
                  <li><a href="#">綠美化</a></li>
                  <li><a href="#">空氣綠牆</a></li>
                </ul>
              </li> -->
            </ul>
          </li>
          <li><a href="articles.html" class="active">最新成果</a></li>
          <li><a href="species.html" >樹種介紹</a></li>
          <li><a href="download.html">文件下載</a></li>
          
         
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>


    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1 class="heading-title">最新花絮文章</h1>
              <p class="mb-0">淨化區建置進度、活動紀錄與環境改善亮點，透過影像與文字分享南投縣推動永續的努力。透過照片、影音與文字故事，呈現綠化成果、社區參與及政策推動的點滴。</p>
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="index.html">首頁</a></li>
            <li class="current">成果花絮</li>
          </ol>
        </div>
      </nav>
    </div><!-- End Page Title -->

    <section id="latest-posts" class="latest-posts section">


      <div class="container" data-aos="fade-up" data-aos-delay="100">
        <div class="row gy-4 align-items-stretch">
          <div class="col-lg-12">
            <div class="row gy-4">
              <div class="col-12" data-aos="fade-left" data-aos-delay="200">
                <article class="compact-post h-100">
                  <div class="thumb">
                    <img src="assets/img/blog/blog-post-4.webp" class="img-fluid" alt="Post thumbnail" loading="lazy">
                  </div>
                  <div class="content">
                    <div class="meta">
                      <span class="date">2025.09.09</span>
                      <span class="dot">•</span>
                      <span class="category">最新花絮</span>
                    </div>
                    <h4 class="title">綠化街道完成建置成果置成果</h4>
                    <p>淨化區建置進度、活動紀錄與環境改善亮點，透過影像與文字分享南投縣推動永續的努力。透過照片、影音與文字故事，呈現綠化成果、社區參與及政策推動的點滴，共同見證南投縣推動環境永續的努力與成果。</p>
                    <a href="articles-details.html" class="readmore"><span>閱讀更多</span><i class="bi bi-arrow-right"></i></a>
                  </div>
                </article>
              </div><!-- End Compact Post -->

              <div class="col-12" data-aos="fade-left" data-aos-delay="300">
                <article class="compact-post h-100">
                  <div class="thumb">
                    <img src="assets/img/blog/blog-post-square-5.webp" class="img-fluid" alt="Post thumbnail" loading="lazy">
                  </div>
                  <div class="content">
                    <div class="meta">
                      <span class="date">2025.09.01</span>
                      <span class="dot">•</span>
                      <span class="category">成果花絮</span>
                    </div>
                    <h4 class="title">我只麼一基本上的樣子優秀</h4>
                    <p>高興，他有該不刻的資訊。加入的角色人知道⋯不可印的那來說是，但其實但自己不，你們什麼真的很友自己寫⋯謝謝小放了。太過回想現登場現自己可以一些，我本是裡的點的各位所以也，的也是有沒了就還有一每天都⋯天還有分鐘的故事，什麼交換設定之中好不對的感覺，首訊應該也為什麼不到你的什麼好。</p>
                    <a href="articles-details.html" class="readmore"><span>閱讀更多</span><i class="bi bi-arrow-right"></i></a>
                  </div>
                </article>
              </div><!-- End Compact Post -->
            </div>
          </div><!-- End Right Column -->



        </div>

      </div>

    </section><!-- /Latest Posts Section -->

    <!-- Pagination 3 Section -->
    <section id="pagination-3" class="pagination-3 section">

      <div class="container">
        <div class="d-flex justify-content-center">
          <ul>
            <li><a href="#"><i class="bi bi-chevron-left"></i></a></li>
            <li><a href="#">1</a></li>
            <li><a href="#" class="active">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li>...</li>
            <li><a href="#">10</a></li>
            <li><a href="#"><i class="bi bi-chevron-right"></i></a></li>
          </ul>
        </div>
      </div>

    </section><!-- /Pagination 3 Section -->

  </main>

  <footer id="footer" class="footer position-relative light-background">

    <div class="container">
      <div class="row gy-5">

        <div class="col-lg-4">
          <div class="footer-brand">
            <a href="index.html" class="logo d-flex align-items-center mb-3">
              <h4>南投縣政府環境保護局</h4>
            </a>
            <p class="tagline">上班(服務)時間：<br>上午 08:00-12:00；下午 13:30-17:30 <br>(週六、日及例假日休息)</p>

            <div class="social-links mt-4">
              <a href="#" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
              <a href="#" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="footer-links-grid">
            <div class="row">
              <div class="col-6 col-md-4">
                <h5>首頁區塊</h5>
                <ul class="list-unstyled">
                  <li><a href="index.html#latest-posts">最新花絮</a></li>
                  <li><a href="index.html#greensituation">綠地現況</a></li>
                  <li><a href="index.html#numberbases">基地數量</a></li>
                </ul>
              </div>
              <div class="col-6 col-md-4">
                <h5>基地介紹</h5>
                <ul class="list-unstyled">
                  <li><a href="basequery.html">空氣品質淨化區</a></li>
                  <li><a href="basequery.html">清淨綠牆</a></li>
                  <li><a href="basequery.html">綠美化</a></li>
                </ul>
              </div>
              <div class="col-6 col-md-4">
                <h5>其他頁面</h5>
                <ul class="list-unstyled">
                  <li><a href="species.html">樹種介紹</a></li>
                  <li><a href="download.html">文件下載</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-2">
          <div class="footer-cta">
            <h5>聯絡我們</h5>
            <p>TEL：(049)223-7530</p>
          </div>
        </div>

      </div>
    </div>

    <div class="footer-bottom">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="footer-bottom-content">
              <p class="mb-0">© <strong>南投縣政府環境保護局版權所有</strong>. All rights reserved.</p>
              <div class="credits">
                Designed by 艾可森數位學習有限公司</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <script>
    (() => {
      // ====== CONFIG ======
      const API_BASE = "";          // set to your API origin if cross-domain
      const RESOURCE = "result";   // list endpoint: /api/results
      const DEFAULT_PAGE_SIZE = 8;
    
      // Read ?page & ?limit (1-based)
      const urlp  = new URLSearchParams(location.search);
      const PAGE  = Math.max(1, parseInt(urlp.get("page")  || "1", 10));
      const LIMIT = Math.max(1, parseInt(urlp.get("limit") || DEFAULT_PAGE_SIZE, 10));
    
      // Targets
      const listRow       = document.querySelector('#latest-posts .col-lg-12 > .row');
      const paginationBox = document.querySelector('#pagination-3 .container .d-flex');
    
      // Helpers
      const esc = (s) => (s == null ? "" : String(s));
      const fmtDate = (d) => {
        if (!d) return "";
        const dt = new Date(d);
        if (isNaN(dt)) return esc(d); // already formatted from backend
        const y = dt.getFullYear();
        const m = String(dt.getMonth() + 1).padStart(2, "0");
        const day = String(dt.getDate()).padStart(2, "0");
        return `${y}.${m}.${day}`;
      };
      const excerpt = (txt, n = 150) => {
        const s = esc(txt).replace(/\s+/g, " ").trim();
        return s.length > n ? s.slice(0, n - 1) + "…" : s;
      };
      const detailURL = (id) => `articles-details.html?id=${encodeURIComponent(id)}`;
    
      function showAlert(msg, variant = "info") {
        const container = document.querySelector("#latest-posts .container");
        if (!container) return;
        let box = document.getElementById("articles-alert");
        if (!box) {
          box = document.createElement("div");
          box.id = "articles-alert";
          container.prepend(box);
        }
        box.className = `alert alert-${variant}`;
        box.textContent = msg;
      }
    
      function renderSkeleton(count = 4) {
        if (!listRow) return;
        listRow.innerHTML = "";
        for (let i = 0; i < count; i++) {
          const col = document.createElement("div");
          col.className = "col-12";
          col.innerHTML = `
            <article class="compact-post h-100 placeholder-wave">
              <div class="thumb">
                <div class="placeholder" style="width:100%;aspect-ratio:16/9;"></div>
              </div>
              <div class="content">
                <div class="meta">
                  <span class="placeholder col-2">&nbsp;</span>
                  <span class="dot">•</span>
                  <span class="placeholder col-2">&nbsp;</span>
                </div>
                <h4 class="title placeholder col-6">&nbsp;</h4>
                <p class="placeholder col-12">&nbsp;</p>
              </div>
            </article>`;
          listRow.appendChild(col);
        }
      }
    
      function renderList(items) {
        if (!listRow) return;
        listRow.innerHTML = "";
    
        if (!Array.isArray(items) || items.length === 0) {
          listRow.innerHTML = `<div class="col-12"><div class="alert alert-secondary">目前沒有可顯示的文章。</div></div>`;
          return;
        }
    
        items.forEach((it, idx) => {
          // === exact mapping to your schema ===
          const id        = it.id;
          const title     = it.title || "(未命名)";
          const dateStr   = fmtDate(it.date);           // DATE column
          const body      = it.content || "";           // TEXT column
          const cover     = it.image_url || "https://placehold.co/800x450?text=No+Image";
    
          const col = document.createElement("div");
          col.className = "col-12";
          col.setAttribute("data-aos", "fade-left");
          col.setAttribute("data-aos-delay", String(150 + 50 * (idx % 4)));
    
          col.innerHTML = `
            <article class="compact-post h-100">
              <div class="thumb">
                <img src="${esc(cover)}" class="img-fluid" alt="Post thumbnail" loading="lazy">
              </div>
              <div class="content">
                <div class="meta">
                  <span class="date">${esc(dateStr)}</span>
                  <span class="dot">•</span>
                  <span class="category">最新花絮</span>
                </div>
                <h4 class="title">${esc(title)}</h4>
                <p>${esc(excerpt(body, 160))}</p>
                <a href="${detailURL(id)}" class="readmore">
                  <span>閱讀更多</span><i class="bi bi-arrow-right"></i>
                </a>
              </div>
            </article>`;
          listRow.appendChild(col);
        });
      }
    
      function renderPagination({ page, totalPages }) {
        if (!paginationBox) return;
        const ul = document.createElement("ul");
    
        const addLink = (label, p, active = false, disabled = false) => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = disabled ? "#" : `?page=${p}&limit=${LIMIT}`;
          if (active) a.className = "active";
          a.innerHTML = label;
          if (disabled) a.setAttribute("aria-disabled", "true");
          li.appendChild(a);
          ul.appendChild(li);
        };
    
        addLink('<i class="bi bi-chevron-left"></i>', Math.max(1, page - 1), false, page === 1);
    
        const windowSize = 5;
        let start = Math.max(1, page - Math.floor(windowSize / 2));
        let end   = Math.min(totalPages, start + windowSize - 1);
        if (end - start + 1 < windowSize) start = Math.max(1, end - windowSize + 1);
    
        if (start > 1) addLink("1", 1);
        if (start > 2) { const dot = document.createElement("li"); dot.textContent = "..."; ul.appendChild(dot); }
    
        for (let p = start; p <= end; p++) addLink(String(p), p, p === page);
    
        if (end < totalPages - 1) { const dot = document.createElement("li"); dot.textContent = "..."; ul.appendChild(dot); }
        if (end < totalPages) addLink(String(totalPages), totalPages);
    
        addLink('<i class="bi bi-chevron-right"></i>', Math.min(totalPages, page + 1), false, page === totalPages);
    
        paginationBox.innerHTML = "";
        paginationBox.appendChild(ul);
      }
    
      // ---- Data loaders ----
    
      // Server pagination (recommended):
      // GET /api/results?page=1&limit=8
      // { items:[...], total:123, page:1, pages:16 }
      async function fetchServerPage() {
        const url = new URL(`${API_BASE}/api/${RESOURCE}`, location.origin);
        url.searchParams.set("page", String(PAGE));
        url.searchParams.set("limit", String(LIMIT));
    
        const res = await fetch(url.toString(), { credentials: "same-origin" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
    
        if (data && Array.isArray(data.items) && (data.pages || data.total)) {
          return {
            items: data.items,
            page: Number(data.page ?? PAGE),
            total: Number(data.total ?? data.items.length),
            totalPages: Number(data.pages ?? Math.ceil((data.total || 0) / LIMIT)) || 1,
          };
        }
    
        // Fallback: body is plain array, use X-Total-Count header if present
        const items = Array.isArray(data) ? data : [];
        const totalHeader = Number(res.headers.get("X-Total-Count") || items.length || 0);
        const totalPages = Math.max(1, Math.ceil(totalHeader / LIMIT));
        return { items, page: PAGE, total: totalHeader, totalPages };
      }
    
      // No server pagination → client-side slice
      async function fetchAllThenSlice() {
        const res = await fetch(`${API_BASE}/api/${RESOURCE}`, { credentials: "same-origin" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const all = await res.json();
        const total = Array.isArray(all) ? all.length : 0;
        const start = (PAGE - 1) * LIMIT;
        const pageItems = (Array.isArray(all) ? all : []).slice(start, start + LIMIT);
        return { items: pageItems, page: PAGE, total, totalPages: Math.max(1, Math.ceil(total / LIMIT)) };
      }
    
      (async function init() {
        renderSkeleton(4);
        showAlert("載入中…", "info");
        try {
          let payload = await fetchServerPage();
    
          // If server ignored page/limit, fall back to client-side paging
          if (payload.total > LIMIT && payload.totalPages <= 1 && payload.items.length === payload.total) {
            payload = await fetchAllThenSlice();
          }
    
          renderList(payload.items);
          renderPagination({ page: payload.page, totalPages: payload.totalPages });
          showAlert("載入完成", "success");
          setTimeout(() => document.getElementById("articles-alert")?.remove(), 1200);
        } catch (err) {
          console.error(err);
          showAlert("載入文章列表失敗，請稍後再試。", "danger");
          if (listRow) listRow.innerHTML = "";
        }
      })();
    })();
    </script>
    

</body>

</html>