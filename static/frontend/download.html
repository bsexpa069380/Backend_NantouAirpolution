<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>南投環保局空氣品質淨化區資訊網</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

</head>
<style>
  .table tbody tr {
    height: 60px;  /* 固定行高 */
    vertical-align: middle;
    text-align: center;
  }
</style>

<body class="category-page">

  <header id="header" class="header d-flex align-items-center position-relative">
    <div class="container position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.webp" alt=""> -->
        <h1 class="sitename"><img src="assets/img/logo.png" alt="Blog Hero Image"></h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li class="dropdown"><a href="#"><span>基地介紹</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="basequery.html">空氣品質淨化區</a></li>
              <li><a href="basequery.html">清淨綠牆</a></li>
              <li><a href="basequery.html">綠美化</a></li>


              <!-- <li class="dropdown"><a href="#"><span>基地介紹</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                  <li><a href="#">空品淨化區</a></li>
                  <li><a href="#">綠美化</a></li>
                  <li><a href="#">空氣綠牆</a></li>
                </ul>
              </li> -->
            </ul>
          </li>
          <li><a href="articles.html">最新成果</a></li>
          <li><a href="species.html" >樹種介紹</a></li>
          <li><a href="download.html" class="active">文件下載</a></li>
          
         
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>


    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1 class="heading-title">下載專區</h1>
              <p class="mb-0">淨化區建置進度、活動紀錄與環境改善亮點，透過影像與文字分享南投縣推動永續的努力。透過照片、影音與文字故事，呈現綠化成果、社區參與及政策推動的點滴。.</p>
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="index.html">首頁</a></li>
            <li class="current">下載專區</li>
          </ol>
        </div>
      </nav>
    </div><!-- End Page Title -->
     


    <div class="container my-4">
      <div class="card shadow-sm rounded-3">
        <!-- 手機可水平 + 垂直捲動 -->
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
          <table class="table zebra table-hover align-middle mb-0 w-100 w-sm-100" style="min-width: 700px;">
            <thead class="table-primary sticky-top text-center" style="height: 60px; vertical-align:middle;">
              <tr>
                <th scope="col">編號</th>
                <th scope="col">標題</th>
                <th scope="col">日期</th>
                <th scope="col">備註</th>
                <th scope="col">下載</th>

              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>南投縣政府空氣品質淨化區設置及管理要點</td>
                <td>空氣品質淨化</td>
                <td>114年度高雄市公有苗圃苗木申領資訊(0507更新)</td>
                <td><a href="#">點擊下載 <i class="bi bi-download"></i></a></td>
              </tr>

            </tbody>

          </table>
        </div>
      </div>
    </div>

    <section id="pagination-2" class="pagination-2 section">

      <div class="container">
        <div class="d-flex justify-content-center">
          <ul>
            <li><a href="#"><i class="bi bi-chevron-left"></i></a></li>
            <li><a href="#">1</a></li>
            <li><a href="#" class="active">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li>...</li>
            <li><a href="#">10</a></li>
            <li><a href="#"><i class="bi bi-chevron-right"></i></a></li>
          </ul>
        </div>
      </div>

    </section><!-- /Pagination 2 Section -->
    
    

  </main>

  <footer id="footer" class="footer position-relative light-background">

    <div class="container">
      <div class="row gy-5">

        <div class="col-lg-4">
          <div class="footer-brand">
            <a href="index.html" class="logo d-flex align-items-center mb-3">
              <h4>南投縣政府環境保護局</h4>
            </a>
            <p class="tagline">上班(服務)時間：<br>上午 08:00-12:00；下午 13:30-17:30 <br>(週六、日及例假日休息)</p>

            <div class="social-links mt-4">
              <a href="#" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
              <a href="#" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="footer-links-grid">
            <div class="row">
              <div class="col-6 col-md-4">
                <h5>首頁區塊</h5>
                <ul class="list-unstyled">
                  <li><a href="index.html#latest-posts">最新花絮</a></li>
                  <li><a href="index.html#greensituation">綠地現況</a></li>
                  <li><a href="index.html#numberbases">基地數量</a></li>
                </ul>
              </div>
              <div class="col-6 col-md-4">
                <h5>基地介紹</h5>
                <ul class="list-unstyled">
                  <li><a href="basequery.html">空氣品質淨化區</a></li>
                  <li><a href="basequery.html">清淨綠牆</a></li>
                  <li><a href="basequery.html">綠美化</a></li>
                </ul>
              </div>
              <div class="col-6 col-md-4">
                <h5>其他頁面</h5>
                <ul class="list-unstyled">
                  <li><a href="species.html">樹種介紹</a></li>
                  <li><a href="download.html">文件下載</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-2">
          <div class="footer-cta">
            <h5>聯絡我們</h5>
            <p>TEL：(049)223-7530</p>
          </div>
        </div>

      </div>
    </div>

    <div class="footer-bottom">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="footer-bottom-content">
              <p class="mb-0">© <strong>南投縣政府環境保護局版權所有</strong>. All rights reserved.</p>
              <div class="credits">
                Designed by 艾可森數位學習有限公司</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <script>
    (() => {
      // ===== CONFIG =====
      const API_BASE = "";         // same-origin; set to "http://127.0.0.1:5000" if API runs elsewhere
      const RESOURCE = "file";     // /api/file  (list), /api/file/:id (single)
      const DEFAULT_PAGE_SIZE = 10;
    
      // Read ?page & ?limit (1-based)
      const urlp  = new URLSearchParams(location.search);
      const PAGE  = Math.max(1, parseInt(urlp.get("page")  || "1", 10));
      const LIMIT = Math.max(1, parseInt(urlp.get("limit") || DEFAULT_PAGE_SIZE, 10));
    
      // Targets
      const tbody      = document.querySelector(".table tbody");
      const pagerWrap  = document.querySelector('#pagination-2 .container .d-flex');
    
      // Helpers
      const esc = (s) => (s == null ? "" : String(s));
      const fmtDate = (d) => {
        if (!d) return "";
        const dt = new Date(d);
        if (isNaN(dt)) return esc(d); // backend may already format
        const y = dt.getFullYear();
        const m = String(dt.getMonth() + 1).padStart(2, "0");
        const day = String(dt.getDate()).padStart(2, "0");
        return `${y}.${m}.${day}`;
      };
    
      function showAlert(msg, variant="info") {
        const container = document.querySelector(".container.my-4") || document.body;
        let box = document.getElementById("download-alert");
        if (!box) {
          box = document.createElement("div");
          box.id = "download-alert";
          container.prepend(box);
        }
        box.className = `alert alert-${variant} mt-3`;
        box.textContent = msg;
      }
    
      function renderSkeleton(rows = 6) {
        if (!tbody) return;
        tbody.innerHTML = "";
        for (let i = 0; i < rows; i++) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="placeholder-glow"><span class="placeholder col-4">&nbsp;</span></td>
            <td class="placeholder-glow"><span class="placeholder col-8">&nbsp;</span></td>
            <td class="placeholder-glow"><span class="placeholder col-5">&nbsp;</span></td>
            <td class="placeholder-glow"><span class="placeholder col-9">&nbsp;</span></td>
            <td class="placeholder-glow"><span class="placeholder col-6">&nbsp;</span></td>
          `;
          tbody.appendChild(tr);
        }
      }
    
      function renderRows(items) {
        if (!tbody) return;
        tbody.innerHTML = "";
    
        if (!Array.isArray(items) || items.length === 0) {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td colspan="5"><div class="alert alert-secondary mb-0">目前沒有可下載的檔案。</div></td>`;
          tbody.appendChild(tr);
          return;
        }
    
        items.forEach((it) => {
          const id    = it.id;
          const title = it.title || "(未命名)";
          const date  = fmtDate(it.date);
          const note  = it.note || "";
          const url   = it.file_url || "";
    
          const tr = document.createElement("tr");
    
          const dlHtml = url
            ? `<a href="${esc(url)}" download target="_blank" rel="noopener">
                 點擊下載 <i class="bi bi-download"></i>
               </a>`
            : `<span class="text-muted" title="無檔案可下載">無檔案</span>`;
    
          tr.innerHTML = `
            <td>${esc(id)}</td>
            <td class="text-start">${esc(title)}</td>
            <td>${esc(date)}</td>
            <td class="text-start">${esc(note)}</td>
            <td>${dlHtml}</td>
          `;
          tbody.appendChild(tr);
        });
      }
    
      function renderPagination({ page, totalPages }) {
        if (!pagerWrap) return;
        const ul = document.createElement("ul");
    
        const addLink = (label, p, active=false, disabled=false) => {
          const li = document.createElement("li");
          const a  = document.createElement("a");
          a.href = disabled ? "#" : `?page=${p}&limit=${LIMIT}`;
          if (active) a.className = "active";
          a.innerHTML = label;
          if (disabled) a.setAttribute("aria-disabled", "true");
          li.appendChild(a);
          ul.appendChild(li);
        };
    
        addLink('<i class="bi bi-chevron-left"></i>', Math.max(1, page - 1), false, page === 1);
    
        const windowSize = 5;
        let start = Math.max(1, page - Math.floor(windowSize / 2));
        let end   = Math.min(totalPages, start + windowSize - 1);
        if (end - start + 1 < windowSize) start = Math.max(1, end - windowSize + 1);
    
        if (start > 1) addLink("1", 1);
        if (start > 2) { const dot = document.createElement("li"); dot.textContent = "..."; ul.appendChild(dot); }
    
        for (let p = start; p <= end; p++) addLink(String(p), p, p === page);
    
        if (end < totalPages - 1) { const dot = document.createElement("li"); dot.textContent = "..."; ul.appendChild(dot); }
        if (end < totalPages) addLink(String(totalPages), totalPages);
    
        addLink('<i class="bi bi-chevron-right"></i>', Math.min(totalPages, page + 1), false, page === totalPages);
    
        pagerWrap.innerHTML = "";
        pagerWrap.appendChild(ul);
      }
    
      // Data loader: server currently returns full array; do client-side paging
      async function fetchAllThenSlice() {
        const res = await fetch(`${API_BASE}/api/${RESOURCE}`, { credentials: "same-origin" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const all = await res.json(); // expecting array: {id,title,date,note,file_url}
        const total = Array.isArray(all) ? all.length : 0;
        const start = (PAGE - 1) * LIMIT;
        const pageItems = (Array.isArray(all) ? all : []).slice(start, start + LIMIT);
        return { items: pageItems, page: PAGE, total, totalPages: Math.max(1, Math.ceil(total / LIMIT)) };
      }
    
      (async function init() {
        renderSkeleton(8);
        showAlert("載入中…", "info");
        try {
          const payload = await fetchAllThenSlice();
          renderRows(payload.items);
          renderPagination({ page: payload.page, totalPages: payload.totalPages });
          showAlert("載入完成", "success");
          setTimeout(() => document.getElementById("download-alert")?.remove(), 1200);
        } catch (err) {
          console.error(err);
          showAlert("載入清單失敗，請稍後再試。", "danger");
          if (tbody) tbody.innerHTML = "";
        }
      })();
    })();
    </script>
    


</body>

</html>

<script>
  document.querySelectorAll(".clickable-row").forEach(row => {
    row.addEventListener("click", () => {
      window.location.href = row.dataset.href;
    });
  });
</script>